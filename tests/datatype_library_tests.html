<html>
  <head>
    <script language="JavaScript" src="../jsunit/app/jsUnitCore.js"></script>
	<script language="JavaScript" src="../jsdatatypelibrary/datatype_library.js"></script>
	<script language="JavaScript" src="../jsdatatypelibrary/validator_objects.js"></script>
	<script language="JavaScript" src="../jsdatatypelibrary/dom_utils.js"></script>
    <script language="JavaScript" src="../jsdatatypelibrary/applyXslt.js"></script>
	<script language="JavaScript" src="manageWhiteSpace.js"></script>
    <script language="JavaScript">
	var datatypeLibrary = new DatatypeLibrary();

	var uri = "http://www.w3.org/2001/XMLSchema-datatypes";
    var paramList;
    var map;
    var context;
	
    function setUp() {
        paramList = new Array();
        map = new Array();
        context = new Context(uri, map);
    }
    
	function testDatatypeAllows_language() {
        datatypeAllows_true("language", "GB");
	}
    function testDatatypeAllows_language_false() {
        datatypeAllows_false("language", "1GE");
	}
    
    function testDatatypeAllows_Name() {
        datatypeAllows_true("Name", "markup_name");
	}
    function testDatatypeAllows_Name_false() {
        datatypeAllows_false("Name", "ma$rkup_name:");
	}
    
    function testDatatypeAllows_NCName() {
        datatypeAllows_true("NCName", "markup_name");
	}
    function testDatatypeAllows_NCName_false() {
        datatypeAllows_false("NCName", "sfe:markup_name");
	}
    
    function testDatatypeAllows_normalizedString() {
        datatypeAllows_true("normalizedString", "string");
	}
    
    function testDatatypeAllows_QName() {
        datatypeAllows_true("QName", "string");
	}
    function testDatatypeAllows_QName_false() {
        datatypeAllows_false("QName", "str	ing ");
	}
    
    function datatypeAllows_true(localname, string) {
        var datatype = new Datatype(uri, localname);
        debug("testDatatypeAllows localname [" + localname + "] string [" + string + "]");
        inform("testing localname [" + localname + "] with string [" + string + "]");
		var resultPattern = datatypeLibrary.datatypeAllows(datatype, paramList, string, context);
		assertTrue("localname [" + localname + "] string [" + string + "]", resultPattern instanceof Empty);
    }
    
    function datatypeAllows_false(localname, string) {
        var datatype = new Datatype(uri, localname);
        debug("testDatatypeAllows localname [" + localname + "] string [" + string + "]");
        inform("testing localname [" + localname + "] with string [" + string + "]");
		var resultPattern = datatypeLibrary.datatypeAllows(datatype, paramList, string, context);
		assertTrue("localname [" + localname + "] string [" + string + "]", resultPattern instanceof NotAllowed);
    }
	
	function testDatatypeAllows_from_jing_trang() {
		var xml_tests = createDocumentFromText(loadFile("from_jing-trang/xsdtest.xml"));
        var datatypeNodes = xml_tests.getElementsByTagName("datatype");
        for (var i = 0 ; i < datatypeNodes.length ; i++) {
            var datatypeNode = datatypeNodes.item(i);
            var name = datatypeNode.getAttribute("name");
            var validNodes = datatypeNode.getElementsByTagName("valid");
            for (var j = 0 ; j < validNodes.length ; j++) {
                var validNode = validNodes.item(j);
                var nodeAtts = validNode.attributes;
                addNamespacesDecl(nodeAtts);
                var value = textContent(validNode);
                datatypeAllows_true(name, value);
            }
			var valueNodes = datatypeNode.getElementsByTagName("value");
            for (var j = 0 ; j < valueNodes.length ; j++) {
                var valueNode = valueNodes.item(j);
                var nodeAtts = valueNode.attributes;
                addNamespacesDecl(nodeAtts);
                var value = textContent(valueNode);
                datatypeAllows_true(name, value);
            }
            var inValidNodes = datatypeNode.getElementsByTagName("invalid");
            for (var j = 0 ; j < inValidNodes.length ; j++) {
                var inValidNode = inValidNodes.item(j);
                var nodeAtts = inValidNode.attributes;
                addNamespacesDecl(nodeAtts);
                var value = textContent(inValidNode);
                datatypeAllows_false(name, value);
            }
        }
	}
    
    function addNamespacesDecl(nodeAtts) {
        for (var i = 0 ; i < nodeAtts.length ; i++) {
            if (nodeAtts[i].nodeName.match('xmlns')) {
                var prefix = nodeAtts[i].localName.replace(/^xmlns$/, "");
                map[prefix] = nodeAtts[i].value;
            }
        }
    }
    

    </script>
  </head>
  <body>
    This is a Test Page for datatype_library.js
  </body>
</html>
